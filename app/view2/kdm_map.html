<script>
    var mapManager;
    $(document).ready(function () {
        $('.to-do-list-dispatch .close,#approve-dispatch-cancel').click(function () {
            $('.to-do-list-dispatch,.overlay').hide();
        });
        setTimeout(function () {
            mapManager.clearMap();
            //Input url here************* Uncomment below
            /*$.get('', function (rawJson) {
            loadMap(rawJson);
            }); */
            //Sample load data
            loadMap(JSON.stringify([{ "coordinates": [{ "lat": 1.397562659547266, "lng": 103.70304107666016 }, { "lat": 1.40374062266067, "lng": 103.7270736694336 }, { "lat": 1.3447060959795738, "lng": 103.7160873413086}], "disaster": "Zombie", "type": "Polygon", "name": "Area1", "time": "2016-10-25T17:41:11.176Z" }, { "coordinates": [{ "lat": 1.4215879797063258, "lng": 103.73531341552734 }, { "lat": 1.4229608476328477, "lng": 103.7710189819336 }, { "lat": 1.3117559678296862, "lng": 103.7710189819336 }, { "lat": 1.318620614005517, "lng": 103.74149322509766}], "disaster": "Terminator", "type": "Polygon", "name": "Area2", "time": "2016-10-25T17:41:15.876Z" }, { "coordinates": [{ "lat": 1.3804015658498483, "lng": 103.80741119384766 }, { "lat": 1.3762828848738569, "lng": 103.9200210571289 }, { "lat": 1.3694184007839654, "lng": 103.86165618896484}], "disaster": "Fire", "type": "Polygon", "name": "Area3", "time": "2016-10-25T17:41:23.126Z" }, { "coordinates": [{ "lat": 1.4174693710318358, "lng": 103.87813568115234}], "disaster": "Safehouse", "type": "Point", "name": "Point4", "time": "2016-10-25T17:41:25.872Z" }, { "coordinates": [{ "lat": 1.3042048352878455, "lng": 103.87676239013672}], "disaster": "Safehouse", "type": "Point", "name": "Point6", "time": "2016-10-25T17:41:26.956Z" }, { "coordinates": [{ "lat": 1.3213664671805336, "lng": 103.6831283569336}], "disaster": "Safehouse", "type": "Point", "name": "Point7", "time": "2016-10-25T17:41:27.804Z"}]));
        }, 500);

        $('.mapInfoPopupInnerWrapper .infoBtn').click(function () {
            var areaData = $('.mapInfoPopup').data('area');
            $('.crisisInfoForm .crisisName').text(mapManager.getDisasterName(areaData.disaster));
            $('.crisisInfoForm .location').text(areaData.location);
            $('.crisisInfoForm .name').text(areaData.name);
            $('.crisisInfoForm .time').text(new Date().toTimeString());
            $('.crisisInfoForm .description').text(areaData.description);
            var severity = 2;
            if (areaData.severity != null) severity = areaData.severity;
            $('.crisisInfoForm .severity').html(generateSeverityBar(severity));
            $('.crisisInfoForm,.overlay').show();
        });
        $('#hideDispatchFormBtn').click(function () {
            $('.dispatchInfoForm,.overlay').hide();
        });
        $('.mapDispatchInfoPopup').click(function () {
            $('.dispatchInfoForm,.overlay').show();
        });
        $('.createMapDispatchInfoPopup').click(function () {
            loadCreateDispatchForm($(this).data('area'));
        });
        $('#approve-dispatch').click(function () {
            $('.to-do-list-dispatch,.overlay,.createMapDispatchInfoPopup').hide();
            var area = $('.createMapDispatchInfoPopup').data('area');
            area.dispatch = {};
            area.dispatch.agency = $('.to-do-list-dispatch .agency').val();
            area.dispatch.resource = $('.to-do-list-dispatch .resource').val();
            area.dispatch.contact = $('.to-do-list-dispatch .contact').val();
            $('.to-do-list-dispatch .agency option')[0].selected = true;
            $('.to-do-list-dispatch .resource option')[0].selected = true;
            $('.to-do-list-dispatch .contact').val('');
            $('.to-do-list-dispatch .time').val('');
                $('.mapDispatchInfoPopup').show();
        });
    });
    function loadMap(raw) {
        mapManager.loadMap(raw);
    }
    function initMap() {
        mapManager = new MapManager();
        mapManager.initializeMap(document.getElementById('map'));
        mapManager.areaManager.onAreaChangeCallback = function (area) {
            createNewAreaItem(area);
        };
        mapManager.areaManager.onAreaLoadCallback = function (areas) {
            for (var i = 0; i < areas.length; i++) {
                createNewAreaItem(areas[i]);
            }
            $('.crisisReportForm').hide();
        }
        mapManager.onAreaSpaceClickCallback = function (area) {
            genericOnAreaSpaceClickCallback(area);
            $('.to-do-list-dispatch .location').text(area.location);
            if (area.dispatch != null) {
                $('.mapDispatchInfoPopup').show();
                $('.createMapDispatchInfoPopup').hide();
                $('.dispatchInfoForm .agency').text(area.dispatch.agency);
                $('.dispatchInfoForm .resource').text(area.dispatch.resource);
                $('.dispatchInfoForm .contact').text(area.dispatch.contact);
            }
            else {
                $('.createMapDispatchInfoPopup').show().data('area', area);
                $('.mapDispatchInfoPopup').hide();
            }
        };

    }
    function loadCreateDispatchForm(area) {
        $('.to-do-list-dispatch .disasterType').text(mapManager.getDisasterName(area.disaster));
        $('.to-do-list-dispatch .location').text(area.location);
        $('.to-do-list-dispatch .time').text(new Date().toTimeString());
        $('.to-do-list-dispatch .description').text(area.description);
        var severity = 2;
        if (area.severity != null) severity = area.severity;
        $('.to-do-list-dispatch .severity').html(generateSeverityBar(severity));
        $('.to-do-list-dispatch,.overlay').show();
    }
</script>
<script src="scripts/map/generic_map.js" async defer></script>  
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCanXJuqR9G83t3TPpOBySHq-4gx2_7DUA&callback=initMap" async defer></script>
    
<div class="mapWrapper">
            <div class="innerMapWrapper">
                
            <div class="verticalOptionsWrapper">
        <div class="verticalOptions">
            <div class="typeWrapper" style="    margin-bottom: -11px;">
             <span class="typeLabel">Type</span>
            <select class="disasterType">
                <option>Crisis map</option>
                <option>Reporting map</option>
                <option>Public map</option>
            </select></div>
        </div>
                <div class="todoListBox"><div class="box-header">
                    <i class="ion ion-clipboard"></i>
                    <h3 class="box-title">Events</h3>
                    <ul class="items">
                        <li><span class="handle-disabled">
                        <i class="fa fa-ellipsis-v"></i>
                        <i class="fa fa-ellipsis-v"></i>
                      </span><span><>: Dispatch Requires Approval</span>
                            <small class="label label label-primary ng-scope"><i class="fa fa-clock-o"></i> <span am-time-ago="todo.time"></span></small>
                        </li>
                    </ul>
                </div></div></div>
            <div id="map"></div>
                <div class="createMapDispatchInfoPopup mapInfoPopupTypes">
                    <div class="mapDispatchInfoPopupInnerWrapper">
                    <div class="crisisLabel">Create dispatch</span></div>
                        </div>
                </div>
                <div class="mapDispatchInfoPopup mapInfoPopupTypes">
                    <div class="mapDispatchInfoPopupInnerWrapper">
                    <div class="crisisLabel">Dispatch status</span></div>
                        </div>
                </div>
                <div class="mapInfoPopup">
                    <div class="mapInfoPopupInnerWrapper">
                    <div class="crisisLabel"><span class="crisisName">Thunderstorm at NTU</span><span class="infoBtn">?</span><br><span class="crisisType"></span></div>
                        
                    <div class="severityLabel">Severity: 
                        <div class="severityBarWrapper">
           <span class="radio"><span class="innerRadio"></span></span>
           <span class="radio"><span class="innerRadio"></span></span>
           <span class="radio"><span class="innerRadio"></span></span>
           <span class="radio"><span class="innerRadio"></span></span>
           <span class="radio"><span class="innerRadio"></span></span></div>
                    </div>
                        </div>
                </div>
</div>
    <div class="ng-scope"><div class="modal-dialog modal-primary to-do-list-dispatch ng-scope">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancel()"><span aria-hidden="true">Ã—</span></button>
            <h4 class="modal-title ng-binding">Dispatching resources for crisis</h4>
        </div>
        <div class="modal-body">
            <h3>Crisis Event</h3>
            <hr>
            <div class="event-detail event-type">
                <span class="event-title">Event Type:</span>
                <span class="event-content ng-binding disasterType"></span>
            </div>
            <div class="event-detail event-time">
                <span class="event-title">Time:</span>
                <span class="event-content ng-binding time"></span>
            </div>
            <div class="event-detail event-location">
                <span class="event-title">Location:</span>
                <span class="event-content ng-binding location"></span>
            </div>
            <div class="event-detail event-severity">
                <span class="event-title">Severity:</span>
                <span class="event-content severity">
                </span>
            </div>
            <div class="event-detail event-description">
                <span class="event-title">Description: </span>
                <span class="event-content ng-binding description"></span>
            </div>

            <h3>Dispatch</h3>
            <hr>
            <div class="event-detail event-agency">
                <span class="event-title">Agency:</span>
                <span class="event-content"><select class="agency"><option value="Police force">Police force</option><option value="Fire department">Fire department</option><option value="Military">Military</option></select></span>
            </div>
            <div class="event-detail event-resource">
                <span class="event-title">Resources:</span>
                <span class="event-content"><select class="resource"><option value="A few police cars">A few police cars</option><option value="SWAT team">SWAT team</option></select></span>
            </div>
            <div class="event-detail event-time">
                <span class="event-title">Time:</span>
                <input type="text" class="time">
            </div>
            <div class="event-detail event-contact">
                <span class="event-title">Contact:</span>
                <input type="text" class="contact">
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline pull-left" data-dismiss="modal" ng-click="cancel()">Close</button>

            <button type="button" id="approve-dispatch-cancel" class="btn btn-outline">Cancel</button>
            <button type="button" id="approve-dispatch" class="btn btn-outline"><span>Dispatch</span></button>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal-dialog --></div>
</div>

    <div ng-include="'view2/maps/crisis_info_form.html'"></div>

<div class="dispatchInfoForm">
    <h1>Dispatch status</h1>
    <span class="formLabel">Location:</span>
    <span class="infoWrapper location">Nanyang Technological University</span>
    <span class="formLabel">Agency:</span>
    <span class="infoWrapper agency">Police force</span>
    <span class="formLabel">Resource:</span>
    <span class="infoWrapper resource">A few police cars</span>
    <span class="formLabel">Contact:</span>
    <span class="infoWrapper contact">+65 97321432 (Mr James, Police Officer)</span><br>
    <div style="text-align: center;margin-top: 10px;"><span id="hideDispatchFormBtn" >Close</span></div></div>